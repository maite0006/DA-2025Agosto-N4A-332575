<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tablero de control del propietario</title>
  <link rel="stylesheet" href="css/menuPropietario.css">
  
</head>

<body>
  <header class="topbar">
    <h1>Tablero de control del propietario</h1>
    <a href="#" onclick="logout()">Salir</a>
  </header>

  <main class="dashboard">

    <!-- Resumen propietario -->
    <section class="card resumen">
      <h2>Resumen del propietario</h2>
      <div class="resumen-grid">
        <div class="campo">
          <label>Nombre completo</label>
          <p id="nombrePropietario"></p>
        </div>
        <div class="campo">
          <label>Estado</label>
          <p id="estadoPropietario"></p>
        </div>
        <div class="campo">
          <label>Saldo actual</label>
          <p id="saldoPropietario"></p>
        </div>
      </div>
    </section>

    <!-- Bonificaciones y Vehículos -->
    <div class="grid-2">
      <section class="card">
        <h2>Bonificaciones asignadas</h2>
        <table>
          <thead>
            <tr><th>Bonificación</th><th>Puesto</th><th>Fecha asignada</th></tr>
          </thead>
          <tbody id="tablaBonificaciones">
            <tr><td>Frecuente</td><td>Peaje Norte</td><td>2025-01-10</td></tr>
            <tr><td>Trabajador</td><td>Peaje Centro</td><td>2025-03-02</td></tr>
          </tbody>
        </table>
      </section>

      <section class="card">
        <h2>Vehículos registrados</h2>
        <table>
          <thead>
            <tr><th>Matrícula</th><th>Modelo</th><th>Color</th><th>Tránsitos</th><th>Monto total</th></tr>
          </thead>
          <tbody id="tablaVehiculos">
            <tr><td>SAB1234</td><td>Sedán</td><td>Azul</td><td>12</td><td>$ 1.240,00</td></tr>
            <tr><td>SCD5678</td><td>SUV</td><td>Gris</td><td>8</td><td>$ 980,00</td></tr>
          </tbody>
        </table>
      </section>
    </div>

    <!-- Tránsitos realizados -->
    <section class="card">
      <h2>Tránsitos realizados</h2>
      <table>
        <thead>
          <tr>
            <th>Puesto</th><th>Matrícula</th><th>Categoría</th>
            <th>Monto tarifa</th><th>Bonificación</th>
            <th>Monto bonificación</th><th>Monto pagado</th>
            <th>Fecha</th><th>Hora</th>
          </tr>
        </thead>
        <tbody id="tablaTransitos">
          <tr><td>Peaje Sur</td><td>SAB1234</td><td>Motocicleta</td>
              <td>$ 120,00</td><td>Frecuente</td><td>- $ 24,00</td>
              <td>$ 96,00</td><td>2025-09-19</td><td>18:45</td></tr>
        </tbody>
      </table>
    </section>

    <!-- Notificaciones -->
    <section class="card">
      <h2>Notificaciones del sistema</h2>
      <table>
        <thead><tr><th>Mensaje</th><th>Fecha</th></tr></thead>
        <tbody id="tablaNotificaciones">
          <tr><td>Su bonificación “Frecuente” fue renovada.</td><td>2025-09-21</td></tr>
        </tbody>
      </table>
      <button class="btn-borrar" onclick="borrarNotificaciones()">Borrar notificaciones</button>
    </section>
  </main>
  <script src="utilesVista.js"></script>
 <script src="vistaWeb.js"></script>
</body>
  <script>
    urlIniciarVista="/menuProp/vistaConectada";
	urlRegistroSSE = "/menuProp/registrarSSE"; 
    function logout() { submit('/accesoPropietario/logout', '', 'POST'); }
    function borrarNotificaciones() { /* lógica SSE o servicio */ }
    
    function mostrar_logoutExitoso(urlDestino) {
        window.location.href = urlDestino;
    }

    function mostrar_usuarioNoAutenticado(urlDestino) {
        window.location.href = urlDestino;
    }
    function mostrar_Estado(estado){
        document.getElementById("estadoPropietario").innerHTML=estado;
    }
    function mostrar_NombreUsuario(nombreUsuario){
        document.getElementById("nombrePropietario").innerHTML=nombreUsuario
    }
    function mostrar_SaldoActual(saldoActual){
         document.getElementById("saldoPropietario").innerHTML=saldoActual;
    }
    const evtSource = new EventSource(urlRegistroSSE);

    evtSource.onmessage = function(event) {
        const listaRespuestas = JSON.parse(event.data); 
        procesarResultadosSubmit(listaRespuestas); 
    };
    function conexionSSECerrada(event){
            cerrar();
    }
    async function cerrar(){
        let respuesta = await mostrarConfirmacion("Se ha cerrado la aplicacion en esta ventana", "Intenar volver a abrirla", "Cerrar");
        if (respuesta) {
            location.reload();
        } else {
            document.body.innerHTML = '';
        }
    }

  </script>
</html>
